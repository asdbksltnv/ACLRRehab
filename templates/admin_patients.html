{% extends "base.html" %}

{% block content %}
  {% include "admin_nav.html" %}

  <section class="section" id="patients">
    <div class="section-head">
      <h2 data-i18n="adminPatientsTitle">Bemorlar</h2>
      <p data-i18n="adminPatientsSub">Bemorlarni qo‘shish, kuzatish va o‘chirish.</p>
    </div>
    <div class="card">
      <form class="auth-form" method="post" action="{{ url_for('admin_add_patient') }}">
        <div class="form-grid">
          <div class="form-field">
            <label data-i18n="labelEmail">Email</label>
            <input type="email" name="email" required />
          </div>
          <div class="form-field">
            <label data-i18n="labelPassword">Parol</label>
            <input type="text" name="password" required />
          </div>
          <div class="form-field">
            <label data-i18n="labelSurgeryDate">Operatsiya sanasi</label>
            <input type="date" name="surgery_date" />
          </div>
          <div class="form-field">
            <label data-i18n="labelPostopWeek">Post-op hafta (qo'lda)</label>
            <input type="number" name="postop_week" min="1" placeholder="1" />
          </div>
          <div class="form-field">
            <label data-i18n="labelProtocol">Protokol</label>
            <select name="protocol_id" data-protocol-select>
              <option value="">—</option>
              {% for protocol in protocol_options %}
                <option
                  value="{{ protocol.id }}"
                  data-label-uz="{{ protocol.name_uz }}"
                  data-label-ru="{{ protocol.name_ru }}"
                >
                  {{ protocol.name_uz }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <button class="btn primary" type="submit" data-i18n="adminAddPatient">Bemor qo‘shish</button>
      </form>
    </div>

    <div class="card table-card">
      <table class="table">
        <thead>
          <tr>
            <th data-i18n="tablePatient">Bemor</th>
            <th data-i18n="labelSurgeryDate">Operatsiya sanasi</th>
            <th data-i18n="labelPostopWeek">Post-op hafta (qo'lda)</th>
            <th data-i18n="labelProtocol">Protokol</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for patient in patients %}
            <tr>
              <td>{{ patient['email'] }}</td>
              <td>{{ patient['surgery_date'] or '—' }}</td>
              <td>{{ patient['week_override'] or '—' }}</td>
              <td>{{ patient['protocol_id'] or '—' }}</td>
              <td class="table-actions">
                <a class="btn tiny" href="{{ url_for('admin_patient_detail', user_id=patient['id']) }}" data-i18n="viewButton">Ko‘rish</a>
                <a class="btn ghost tiny" href="{{ url_for('admin_patient_detail', user_id=patient['id']) }}#patient-logs" data-i18n="viewLogsButton">Loglar</a>
                <form method="post" action="{{ url_for('admin_delete_patient', user_id=patient['id']) }}">
                  <button class="btn ghost tiny" type="submit" data-i18n="deleteButton">O‘chirish</button>
                </form>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="5" data-i18n="adminNoPatients">Hozircha bemorlar yo‘q.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
{% endblock %}
